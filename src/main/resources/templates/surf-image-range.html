<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta name="viewport" content="initial-scale=1, width=device-width" charset="UTF-8">
        <title>파도 예보</title>
        <link th:href="@{/css/bootstrap.min.css}" href="css/bootstrap.min.css" rel="stylesheet">
        <style>
            html, body {
                touch-action: manipulation;
                -ms-touch-action: manipulation;
            }
            #dateDisplay {
                position: relative;
                width: 70px;
                display: block;
                text-align: center;
                left: -20px;
            }
        </style>
    </head>

    <body class="container">

        <header class="row mt-3 mx-auto">
            <a type="button" class="btn btn-outline-primary col-xxl-1 col-md-2 col-sm-3 col-4" href="/">< 뒤로 가기</a>

            <div class="dropdown col">
                <button class="btn btn-info dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                    WSB 파도 웹캠
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <li><a class="dropdown-item" href="https://www.wsbfarm.com/su/DZ59T" target="_blank">죽도 해변</a></li>
                    <li><a class="dropdown-item" href="https://www.wsbfarm.com/su/DRW5B" target="_blank">인구 해변</a></li>
                    <li><a class="dropdown-item" href="https://www.wsbfarm.com/su/TG1LU" target="_blank">기사문 해변</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="https://www.wsbfarm.com/su/XaBOj" target="_blank">송정 해변</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="https://www.wsbfarm.com/su/6N0Ay" target="_blank">만리포 해변</a></li>
                </ul>
            </div>
        </header>

        <h1 id="title" class="text-center m-2"
            th:text="|[${chartDtos[0].day}일] ${chartDtos[0].dayOfWeek} ${chartDtos[0].hour}시|"></h1>

        <div id="contents-container" class="row justify-content-center">
            <img id="image" th:src="${chartDtos[0].imagePath}" alt="이미지" class="col-lg-8">

            <div id="button-container" class="row col-lg-4 justify-content-center align-self-center">
                <div class="row my-2">
                    <button id="prev-btn" class="all-btn btn btn-lg btn-outline-secondary col">< 이전</button>
                    <button id="next-btn" class="all-btn btn btn-lg btn-outline-secondary col">이후 ></button>
                </div>
                <div class="range">
                    <input type="range" class="form-range" min="0" th:max="${#lists.size(chartDtos)-1}" value="0" id="imageRange">
                    <div id="dateDisplay">
                        <p th:text="|${chartDtos[0].day}일 ${chartDtos[0].hour}시|"></p>
                    </div>
                </div>
            </div>
        </div>
    </body>

    <script th:inline="javascript">
        const prevButton = document.getElementById("prev-btn");
        const nextButton = document.getElementById("next-btn");
        const rangeInput = document.getElementById("imageRange");
        const image = document.getElementById("image");
        const title = document.getElementById("title");
        var list = [[${chartDtos}]];
        var chart = list[0];

        const dateText = document.getElementById("dateDisplay");
        var inputWidth = rangeInput.offsetWidth;
        var textWidth = dateText.offsetWidth;
        var splitWidth = inputWidth / (list.length + 1);
        var startLeft = -20;

        rangeInput.addEventListener("input", function() {
            const inputValue = this.value;
            chart = list[inputValue];
            image.src = chart.imagePath;
            title.innerText = `[${chart.day}일] ${chart.dayOfWeek} ${chart.hour}시`;

            //text 위치와 내용 조정
            var position = startLeft + splitWidth * inputValue;
            dateText.style.left = `${position}px`;
            dateText.innerText = `${chart.day}일 ${chart.hour}시`;
        });

        prevButton.addEventListener("click", function() {
            //input에 맞는 이미지 보여주는 로직
            value = rangeInput.value;
            value--;
            if (value < 0) {
                value = list.length - 1;
            }
            chart = list[value];
            image.src = chart.imagePath;
            title.innerText = `[${chart.day}일] ${chart.dayOfWeek} ${chart.hour}시`;
            rangeInput.value = value;

            //date text 위치와 내용 조정 로직
            var position = startLeft + splitWidth * value;
            dateText.style.left = `${position}px`;
            dateText.innerText = `${chart.day}일 ${chart.hour}시`;
        });

        nextButton.addEventListener("click", function() {
            //input에 맞는 이미지 보여주는 로직
            value = rangeInput.value;
            value++;
            if (value > list.length - 1) {
                value = 0;
            }
            chart = list[value];
            image.src = chart.imagePath;
            title.innerText = `[${chart.day}일] ${chart.dayOfWeek} ${chart.hour}시`;
            rangeInput.value = value;

            //text 위치와 내용 조정
            var position = startLeft + splitWidth * value;
            dateText.style.left = `${position}px`;
            dateText.innerText = `${chart.day}일 ${chart.hour}시`;
        });

        window.addEventListener('resize', function() {
            // 화면 크기 변화를 감지했을 때 넓이를 측정하기 위해 존재
            inputWidth = rangeInput.offsetWidth;
            textWidth = dateText.offsetWidth;
            splitWidth = inputWidth / (list.length + 1);

            // 변화되었을때 알맞은 위치로 조정
            value = rangeInput.value;
            var position = startLeft + splitWidth * value;
            dateText.style.left = `${position}px`;
          });
    </script>
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
</html>